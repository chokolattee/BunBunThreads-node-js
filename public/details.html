<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Product Details</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/11.16.1/sweetalert2.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <style>
        :root {
            --primary-brown: #8B4513;
            --light-brown: #D2B48C;
            --dark-brown: #654321;
            --cream: #F5F5DC;
            --warm-white: #FFF8E7;
            --soft-brown: #DEB887;
            --accent-brown: #A0522D;
        }

        * {
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--warm-white) 0%, var(--cream) 100%);
            min-height: 100vh;
            padding: 20px 0;
        }

        .details-container {
            max-width: 900px;
            margin: 40px auto;
            padding: 0;
            border-radius: 25px;
            background: white;
            box-shadow: 0 20px 60px rgba(139, 69, 19, 0.1);
            overflow: hidden;
            position: relative;
        }

        .details-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, var(--primary-brown), var(--accent-brown), var(--soft-brown));
        }

        .product-card {
            display: flex;
            flex-direction: row;
            gap: 0;
            min-height: 600px;
        }

        .slider-section {
            position: relative;
            background: var(--warm-white);
            padding: 30px;
            border-radius: 25px 0 0 0;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .slider {
            width: 100%;
            max-width: 450px;
            margin: 0 auto;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(139, 69, 19, 0.15);
        }

        .carousel {
            width: 100%;
            max-width: 450px;
            margin: 0 auto;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(139, 69, 19, 0.15);
        }

        .carousel-inner {
            border-radius: 20px;
        }

        .carousel-item img {
            width: 100%;
            height: 400px;
            object-fit: cover;
            border-radius: 20px;
            transition: transform 0.3s ease;
        }

        .carousel-item img:hover {
            transform: scale(1.02);
        }

        .carousel-indicators {
            bottom: -50px;
            margin-bottom: 0;
        }

        .carousel-indicators [data-bs-target] {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--soft-brown);
            opacity: 0.5;
            border: none;
            margin: 0 5px;
        }

        .carousel-indicators .active {
            background-color: var(--primary-brown);
            opacity: 1;
        }

        .carousel-control-prev,
        .carousel-control-next {
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            top: 50%;
            transform: translateY(-50%);
            border: 2px solid var(--soft-brown);
        }

        .carousel-control-prev {
            left: 15px;
        }

        .carousel-control-next {
            right: 15px;
        }

        .carousel-control-prev-icon,
        .carousel-control-next-icon {
            width: 20px;
            height: 20px;
            background-size: 100%, 100%;
        }

        .carousel-control-prev:hover,
        .carousel-control-next:hover {
            background-color: var(--cream);
            transform: translateY(-50%) scale(1.1);
        }

        .slider img {
            width: 100%;
            height: 400px;
            object-fit: cover;
            border-radius: 20px;
            transition: transform 0.3s ease;
        }

        .slider img:hover {
            transform: scale(1.02);
        }

        /* Custom Slick Dots - REMOVED */

        /* Custom Slick Arrows - REMOVED */

        .product-info {
            padding: 40px;
            background: white;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .product-header {
            text-align: left;
            margin-bottom: 30px;
            position: relative;
        }

        .product-name {
            font-size: 28px;
            font-weight: 700;
            color: var(--dark-brown);
            margin-bottom: 15px;
            position: relative;
        }

        .product-name::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-brown), var(--accent-brown));
            border-radius: 2px;
        }

        .product-description {
            color: var(--dark-brown);
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 25px;
            text-align: left;
            opacity: 0.8;
        }

        .price-stock-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--warm-white);
            padding: 20px 25px;
            border-radius: 20px;
            margin-bottom: 30px;
            border: 2px solid var(--cream);
        }

        .product-price {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary-brown);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .price-currency {
            font-size: 24px;
        }

        .stock-badge {
            background: linear-gradient(135deg, var(--soft-brown), var(--light-brown));
            color: var(--dark-brown);
            padding: 8px 16px;
            border-radius: 50px;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stock-icon {
            width: 8px;
            height: 8px;
            background: var(--primary-brown);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .product-actions {
            background: var(--cream);
            padding: 25px;
            border-radius: 20px;
            margin-top: 20px;
        }

        .quantity-section {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 15px;
            margin-bottom: 20px;
        }

        .quantity-label {
            font-weight: 600;
            color: var(--dark-brown);
            font-size: 16px;
        }

        .quantity-selector {
            display: flex;
            align-items: center;
            background: white;
            border-radius: 15px;
            padding: 5px;
            border: 2px solid var(--soft-brown);
            box-shadow: 0 4px 15px rgba(139, 69, 19, 0.1);
        }

        .quantity-selector input {
            width: 80px;
            padding: 12px 16px;
            border: none;
            background: transparent;
            text-align: center;
            font-size: 18px;
            font-weight: 600;
            color: var(--dark-brown);
            outline: none;
        }

        .quantity-selector input::-webkit-outer-spin-button,
        .quantity-selector input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .action-buttons {
            display: flex;
            justify-content: flex-start;
        }

        .btn-add-cart {
            background: linear-gradient(135deg, var(--primary-brown), var(--accent-brown));
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 50px;
            color: white;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(139, 69, 19, 0.3);
        }

        .btn-add-cart:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(139, 69, 19, 0.4);
            background: linear-gradient(135deg, var(--accent-brown), var(--primary-brown));
        }

        .btn-add-cart:active {
            transform: translateY(-1px);
        }

        .cart-icon {
            font-size: 20px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {

            0%,
            20%,
            50%,
            80%,
            100% {
                transform: translateY(0);
            }

            40% {
                transform: translateY(-3px);
            }

            60% {
                transform: translateY(-2px);
            }
        }

        .reviews-section {
            padding: 40px;
            background: var(--warm-white);
            border-radius: 0 0 25px 25px;
        }

        .reviews-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .reviews-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--dark-brown);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .reviews-title::before,
        .reviews-title::after {
            content: '';
            flex: 1;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--soft-brown), transparent);
        }

        .review {
            background: white;
            border-radius: 18px;
            padding: 20px;
            margin-bottom: 15px;
            border: 2px solid var(--cream);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .review::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--soft-brown), var(--light-brown));
        }

        .review:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(139, 69, 19, 0.1);
        }

        .reviewer-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .reviewer-name {
            font-weight: 600;
            color: var(--dark-brown);
            font-size: 16px;
        }

        .rating {
            color: var(--accent-brown);
            font-size: 18px;
        }

        .review-text {
            color: var(--dark-brown);
            line-height: 1.6;
            margin: 0;
            opacity: 0.9;
        }

        .no-reviews {
            text-align: center;
            color: var(--dark-brown);
            font-style: italic;
            opacity: 0.7;
            padding: 40px 20px;
            background: white;
            border-radius: 18px;
            border: 2px dashed var(--soft-brown);
        }

        .divider {
            height: 3px;
            background: linear-gradient(90deg, var(--cream), var(--soft-brown), var(--cream));
            border: none;
            margin: 0;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .details-container {
                margin: 20px;
                border-radius: 20px;
            }

            .product-card {
                flex-direction: column;
            }

            .slider-section {
                padding: 20px;
                border-radius: 20px 20px 0 0;
            }

            .slider img {
                height: 300px;
            }

            .carousel-item img {
                height: 300px;
            }

            .product-info {
                padding: 30px 20px;
            }

            .product-name {
                font-size: 24px;
            }

            .product-price {
                font-size: 28px;
            }

            .price-stock-section {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .product-header {
                text-align: center;
            }

            .product-name::after {
                left: 50%;
                transform: translateX(-50%);
            }

            .product-description {
                text-align: center;
            }

            .quantity-section {
                justify-content: center;
            }

            .action-buttons {
                justify-content: center;
            }

            .reviews-section {
                padding: 30px 20px;
            }
        }

        .cart-popup {
            position: fixed;
            top: 20px;
            right: -400px;
            /* Start off-screen */
            width: 350px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            overflow: hidden;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            opacity: 0;
        }

        .cart-popup.active {
            right: 20px;
            opacity: 1;
        }

        .popup-content {
            display: flex;
            align-items: center;
            padding: 15px;
            position: relative;
            border-left: 5px solid #4CAF50;
        }

        .popup-icon {
            width: 50px;
            height: 50px;
            background: #E8F5E9;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .popup-icon svg {
            width: 24px;
            height: 24px;
            color: #4CAF50;
        }

        .popup-text h3 {
            margin: 0 0 5px 0;
            color: #2E7D32;
            font-size: 16px;
            font-weight: 600;
        }

        .popup-text p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }

        .popup-close {
            position: absolute;
            top: 5px;
            right: 10px;
            font-size: 20px;
            color: #888;
            cursor: pointer;
            transition: color 0.3s;
        }

        .popup-close:hover {
            color: #555;
        }

        /* Animation */
        @keyframes cartItemAdded {
            0% {
                transform: translateX(100%);
            }

            20% {
                transform: translateX(-10px);
            }

            40% {
                transform: translateX(5px);
            }

            60% {
                transform: translateX(-5px);
            }

            80% {
                transform: translateX(2px);
            }

            100% {
                transform: translateX(0);
            }
        }

        .cart-popup.active .popup-content {
            animation: cartItemAdded 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        /* Progress bar */
        .popup-content::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            width: 100%;
            background: #E8F5E9;
        }

        .popup-content::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            width: 0;
            background: #4CAF50;
            animation: progress 3s linear forwards;
        }

        @keyframes progress {
            to {
                width: 100%;
            }
        }

        .swal-top-popup {
            margin-top: 20px !important;
            border-radius: 15px !important;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3) !important;
        }

        .swal-title-styled {
            font-size: 24px !important;
            font-weight: 600 !important;
            color: #333 !important;
        }

        .swal-content-styled {
            font-size: 16px !important;
            color: #666 !important;
            line-height: 1.5 !important;
        }

        .swal-confirm-btn {
            background-color: #007bff !important;
            border: none !important;
            border-radius: 8px !important;
            padding: 12px 24px !important;
            font-weight: 600 !important;
            transition: all 0.3s ease !important;
        }

        .swal-confirm-btn:hover {
            background-color: #0056b3 !important;
            transform: translateY(-1px) !important;
        }

        .swal-cancel-btn {
            background-color: #6c757d !important;
            border: none !important;
            border-radius: 8px !important;
            padding: 12px 24px !important;
            font-weight: 600 !important;
            transition: all 0.3s ease !important;
        }

        .swal-cancel-btn:hover {
            background-color: #545b62 !important;
            transform: translateY(-1px) !important;
        }

        /* Make the backdrop more prominent */
        .swal2-backdrop-show {
            background-color: rgba(0, 0, 0, 0.6) !important;
        }

        /* Animation classes (if you want to use animate.css) */
        @keyframes slideInDown {
            from {
                transform: translate3d(0, -100%, 0);
                visibility: visible;
            }

            to {
                transform: translate3d(0, 0, 0);
            }
        }

        @keyframes slideOutUp {
            from {
                transform: translate3d(0, 0, 0);
            }

            to {
                visibility: hidden;
                transform: translate3d(0, -100%, 0);
            }
        }

        .animate__animated {
            animation-duration: 0.3s;
            animation-fill-mode: both;
        }

        .animate__slideInDown {
            animation-name: slideInDown;
        }

        .animate__slideOutUp {
            animation-name: slideOutUp;
        }

        .cart-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: none;
            z-index: 1000;
            max-width: 300px;
        }

        .cart-popup.active {
            display: flex;
            align-items: center;
            animation: slideIn 0.5s, fadeOut 0.5s 2.5s;
        }

        .popup-content {
            display: flex;
            align-items: center;
        }

        .popup-icon svg {
            width: 24px;
            height: 24px;
            margin-right: 10px;
            fill: white;
        }

        .popup-close {
            margin-left: 15px;
            cursor: pointer;
            font-size: 20px;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
            }

            to {
                transform: translateX(0);
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }

            to {
                opacity: 0;
            }
        }
    </style>
</head>

<body>
    <div id="header"></div>


    <div class="details-container">
        <div class="product-card">
            <div class="slider-section">
                <div id="productCarousel" class="carousel slide" data-bs-ride="carousel">
                    <div class="carousel-indicators" id="carouselIndicators"></div>
                    <div class="carousel-inner" id="carouselInner"></div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel"
                        data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#productCarousel"
                        data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
            </div>

            <div class="product-info">
                <div class="product-header">
                    <h3 class="product-name" id="itemName">Loading...</h3>
                    <p class="product-description" id="itemDescription"></p>
                </div>

                <div class="price-stock-section">
                    <div class="product-price">
                        <span class="price-currency">₱</span><span id="itemPrice"></span>
                    </div>
                    <div class="stock-badge">
                        <div class="stock-icon"></div>
                        <span>Stock: <span id="itemStock"></span></span>
                    </div>
                </div>

                <div class="product-actions">
                    <div class="quantity-section">
                        <span class="quantity-label">Quantity:</span>
                        <div class="quantity-selector">
                            <input type="number" id="quantityInput" class="quantity-input" min="1" value="1">
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn-add-cart" id="addToCartBtn">
                            <i class="fas fa-shopping-cart cart-icon"></i>
                            Add to Cart
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <hr class="divider">

        <div class="reviews-section">
            <div class="reviews-header">
                <h4 class="reviews-title">
                    <i class="fas fa-star"></i>
                    Customer Reviews
                    <i class="fas fa-star"></i>
                </h4>
            </div>
            <div id="reviewsContainer">
                <p class="no-reviews">Loading reviews...</p>
            </div>
        </div>
    </div>
    <div class="cart-popup" id="cartPopup">
        <div class="popup-content">
            <div class="popup-icon">
                <svg viewBox="0 0 24 24">
                    <path fill="currentColor"
                        d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z" />
                </svg>
            </div>
            <div class="popup-text">
                <h3>Added to Cart!</h3>
                <p>Your item has been successfully added to your shopping cart.</p>
            </div>
            <div class="popup-close">&times;</div>
        </div>
    </div>

    <script>
        // Helper function to check if user is logged in
        function isUserLoggedIn() {
            const token = localStorage.getItem('token');
            const userId = localStorage.getItem('userId');
            return token && userId;
        }

        // Function to show the cart popup
        function showCartPopup() {
            const popup = document.getElementById('cartPopup');
            popup.classList.add('active');

            // Auto-hide after 3 seconds
            setTimeout(() => {
                popup.classList.remove('active');
            }, 3000);
        }

        $(document).ready(() => {
            const params = new URLSearchParams(window.location.search);
            const itemId = params.get("id");

            fetch(`/api/item/${itemId}`)
                .then(res => {
                    if (!res.ok) throw new Error(`HTTP ${res.status}`);
                    return res.json();
                })
                .then(data => {
                    // Update product info
                    document.getElementById("itemName").textContent = data.item_name;
                    document.getElementById("itemDescription").textContent = data.description;
                    document.getElementById("itemPrice").textContent = data.sell_price;
                    document.getElementById("itemStock").textContent = data.quantity ?? 0;

                    const imageBaseUrl = "/images/";
                    const images = Array.isArray(data.images) && data.images.length
                        ? data.images
                        : ['placeholder.jpg'];

                    // Initialize Bootstrap Carousel
                    const carouselInner = document.getElementById("carouselInner");
                    const carouselIndicators = document.getElementById("carouselIndicators");

                    // Clear any existing items
                    carouselInner.innerHTML = '';
                    carouselIndicators.innerHTML = '';

                    // Add images to carousel
                    images.forEach((img, index) => {
                        // Create carousel item
                        const item = document.createElement("div");
                        item.className = `carousel-item ${index === 0 ? 'active' : ''}`;

                        const imgTag = document.createElement("img");
                        imgTag.src = imageBaseUrl + img;
                        imgTag.className = "d-block w-100";
                        imgTag.alt = data.item_name;
                        imgTag.onerror = function () {
                            this.src = imageBaseUrl + 'placeholder.jpg';
                            this.onerror = null;
                        };

                        item.appendChild(imgTag);
                        carouselInner.appendChild(item);

                        // Create indicator
                        const indicator = document.createElement("button");
                        indicator.type = "button";
                        indicator.dataset.bsTarget = "#productCarousel";
                        indicator.dataset.bsSlideTo = index.toString();
                        indicator.className = index === 0 ? "active" : "";
                        indicator.setAttribute("aria-current", index === 0 ? "true" : "false");
                        indicator.setAttribute("aria-label", `Slide ${index + 1}`);
                        carouselIndicators.appendChild(indicator);
                    });

                    // Set max value of quantity input
                    const quantityInput = document.getElementById("quantityInput");
                    quantityInput.max = data.quantity ?? 1;

                    // Add to Cart with login check
                    document.getElementById("addToCartBtn").addEventListener("click", () => {
                        const isLoggedIn = isUserLoggedIn();

                        if (!isLoggedIn) {

                            window.location.href = "login.html";
                            return;
                        }

                        // Proceed with Add to Cart logic...
                        const quantity = parseInt(quantityInput.value);
                        const availableQuantity = data.quantity ?? 1;

                        if (isNaN(quantity) || quantity < 1) {
                            Swal.fire("Oops", "Please enter a valid quantity (at least 1).", "error");
                            return;
                        }

                        if (quantity > availableQuantity) {
                            Swal.fire("Oops", `Only ${availableQuantity} items available in stock.`, "error");
                            return;
                        }

                        const cart = JSON.parse(localStorage.getItem("cart")) || [];
                        const existingItem = cart.find(item => item.id === data.item_id);

                        if (existingItem) {
                            if ((existingItem.quantity + quantity) > availableQuantity) {
                                Swal.fire("Oops", `You can't add more than ${availableQuantity} items of this product to your cart.`, "error");
                                return;
                            }
                            existingItem.quantity += quantity;
                        } else {
                            cart.push({
                                id: data.item_id,
                                item_name: data.item_name,
                                price: data.sell_price,
                                image_path: images[0],
                                quantity: quantity
                            });
                        }

                        saveCart(cart);
                        itemCount++;
                        $('#itemCount').text(itemCount).css('display', 'block');
                        localStorage.setItem("cart", JSON.stringify(cart));
                        showCartPopup();
                        window.location.href = 'cart.html';
                    });


                    // Render Reviews
                    const reviewsContainer = document.getElementById("reviewsContainer");
                    if (!Array.isArray(data.reviews) || data.reviews.length === 0) {
                        reviewsContainer.innerHTML = "<p class='no-reviews'>No reviews yet for this product.</p>";
                    } else {
                        reviewsContainer.innerHTML = data.reviews.map(review => `
                        <div class="review">
                            <div class="reviewer-info">
                                <span class="reviewer-name">${review.full_name}</span>
                                <span class="rating">${'★'.repeat(review.rating)}${'☆'.repeat(5 - review.rating)}</span>
                            </div>
                            <p class="review-text">${review.review_text}</p>
                        </div>
                    `).join('');
                    }
                })
                .catch(err => {
                    console.error("❌ Fetch error:", err);
                    document.getElementById("itemName").textContent = "Product not found.";
                    document.getElementById("itemDescription").textContent = "";
                    document.getElementById("itemPrice").textContent = "";
                    document.getElementById("itemStock").textContent = "";
                    document.getElementById("reviewsContainer").innerHTML = "<p class='no-reviews'>Unable to load product reviews.</p>";
                });

            // Close button functionality for cart popup
            document.querySelector('.popup-close').addEventListener('click', () => {
                document.getElementById('cartPopup').classList.remove('active');
            });
        });
        function showSuccessNotification(itemName, quantity) {
            const popup = document.getElementById('cartPopup');
            const popupText = popup.querySelector('.popup-text p');

            // Update the popup text
            popupText.textContent = `${quantity} ${itemName} has been successfully added to your cart.`;

            // Show the popup
            popup.classList.add('active');

            // Auto-hide after 3 seconds
            setTimeout(() => {
                popup.classList.remove('active');
            }, 3000);
        }

        // In your add to cart event listener:
        document.getElementById("addToCartBtn").addEventListener("click", () => {
            // ... existing validation code ...

            const cartItem = {
                id: data.item_id,
                item_id: data.item_id, // Add this duplicate field for API compatibility
                item_name: data.item_name,
                price: parseFloat(data.sell_price), // Ensure number
                image_path: images[0],
                quantity: parseInt(quantity) // Ensure number
            };

            const cart = JSON.parse(localStorage.getItem("cart")) || [];
            const checkoutCart = JSON.parse(localStorage.getItem("checkoutCart")) || [];

            // Update both carts
            const existingIndex = cart.findIndex(item => item.id === data.item_id);
            if (existingIndex >= 0) {
                cart[existingIndex].quantity += quantity;
            } else {
                cart.push(cartItem);
            }

            // For checkout cart, replace rather than increment
            const checkoutExistingIndex = checkoutCart.findIndex(item => item.id === data.item_id);
            if (checkoutExistingIndex >= 0) {
                checkoutCart[checkoutExistingIndex] = cartItem;
            } else {
                checkoutCart.push(cartItem);
            }

            localStorage.setItem("cart", JSON.stringify(cart));
            localStorage.setItem("checkoutCart", JSON.stringify(checkoutCart));

            // ... rest of your code ..

            showSuccessNotification(data.item_name, quantity);
        });
    </script>

    <script>
        $(function () {
            $("#header").load("header.html");
        });
        function saveCart(cart) {
            localStorage.setItem("cart", JSON.stringify(cart));
        }

    </script>
</body>

</html>